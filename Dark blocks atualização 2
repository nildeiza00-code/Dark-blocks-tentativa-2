--[[
    Script Profissional de Teleporte + Noclip para Roblox
    Autor: nildeiza00-code + Melhorias para Anti-Cheat e Spawn
    Compatível com Delta
    Versão Melhorada: Correção de Noclip e Otimização Anti-Detecção
]]

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")
local Workspace = game:GetService("Workspace")

local localPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local teleportKey = Enum.KeyCode.F
local noclipKey = Enum.KeyCode.G

local teleportDestination = Vector3.new(100, 50, 200)
local isNoclipActive = false
local isTeleporting = false
local noclipConnection = nil

-- Função para encontrar o Spawn Principal
local function getSpawnPosition()
    local spawns = Workspace:FindFirstChildOfClass("SpawnLocation")
    if spawns then
        return spawns.Position + Vector3.new(0, 3, 0)
    else
        return Vector3.new(0, 10, 0)
    end
end

-- Função para criar GUI com opção de Spawn
local function createTeleportGUI()
    if localPlayer:WaitForChild("PlayerGui"):FindFirstChild("TeleportPanel") then
        localPlayer.PlayerGui.TeleportPanel:Destroy()
    end

    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "TeleportPanel"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = localPlayer.PlayerGui

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 240, 0, 180)
    frame.Position = UDim2.new(0.5, -120, 0.1, 0)
    frame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    frame.BorderSizePixel = 0
    frame.BackgroundTransparency = 0.1
    frame.Parent = screenGui

    local title = Instance.new("TextLabel")
    title.Text = "TELEPORTE PRO"
    title.Size = UDim2.new(1, 0, 0, 28)
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.GothamBold
    title.TextColor3 = Color3.fromRGB(200, 255, 120)
    title.TextSize = 23
    title.Parent = frame

    -- Destino
    local coordsLabel = Instance.new("TextLabel")
    coordsLabel.Text = "Destino (X, Y, Z):"
    coordsLabel.Position = UDim2.new(0, 10, 0, 38)
    coordsLabel.Size = UDim2.new(0, 100, 0, 22)
    coordsLabel.BackgroundTransparency = 1
    coordsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    coordsLabel.Font = Enum.Font.Gotham
    coordsLabel.TextSize = 14
    coordsLabel.Parent = frame

    local xBox = Instance.new("TextBox")
    xBox.PlaceholderText = tostring(teleportDestination.X)
    xBox.Text = tostring(teleportDestination.X)
    xBox.Size = UDim2.new(0, 60, 0, 20)
    xBox.Position = UDim2.new(0, 110, 0, 38)
    xBox.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
    xBox.TextColor3 = Color3.new(1, 1, 1)
    xBox.Font = Enum.Font.Gotham
    xBox.TextSize = 13
    xBox.Parent = frame

    local yBox = xBox:Clone()
    yBox.Position = UDim2.new(0, 175, 0, 38)
    yBox.Text = tostring(teleportDestination.Y)
    yBox.PlaceholderText = tostring(teleportDestination.Y)
    yBox.Parent = frame

    local zBox = xBox:Clone()
    zBox.Position = UDim2.new(0, 110, 0, 62)
    zBox.Size = UDim2.new(0, 125, 0, 20)
    zBox.Text = tostring(teleportDestination.Z)
    zBox.PlaceholderText = tostring(teleportDestination.Z)
    zBox.Parent = frame

    -- Botão Teleporte
    local teleportBtn = Instance.new("TextButton")
    teleportBtn.Text = "Teleportar (F)"
    teleportBtn.Size = UDim2.new(0.7, 0, 0, 32)
    teleportBtn.Position = UDim2.new(0.15, 0, 0, 95)
    teleportBtn.BackgroundColor3 = Color3.fromRGB(90, 190, 120)
    teleportBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
    teleportBtn.Font = Enum.Font.GothamBold
    teleportBtn.TextSize = 18
    teleportBtn.Parent = frame

    -- Botão para Spawn Principal
    local spawnBtn = Instance.new("TextButton")
    spawnBtn.Text = "Teleportar para Spawn"
    spawnBtn.Size = UDim2.new(0.7, 0, 0, 26)
    spawnBtn.Position = UDim2.new(0.15, 0, 0, 130)
    spawnBtn.BackgroundColor3 = Color3.fromRGB(120, 90, 190)
    spawnBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    spawnBtn.Font = Enum.Font.GothamBold
    spawnBtn.TextSize = 14
    spawnBtn.Parent = frame

    -- Botão Noclip
    local noclipBtn = Instance.new("TextButton")
    noclipBtn.Text = "Noclip: DESLIGADO (G)"
    noclipBtn.Size = UDim2.new(0.7, 0, 0, 26)
    noclipBtn.Position = UDim2.new(0.15, 0, 0, 160)
    noclipBtn.BackgroundColor3 = Color3.fromRGB(180, 80, 80)
    noclipBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    noclipBtn.Font = Enum.Font.GothamBold
    noclipBtn.TextSize = 14
    noclipBtn.Parent = frame

    -- Atualiza destino
    local function updateDestination()
        local x = tonumber(xBox.Text) or teleportDestination.X
        local y = tonumber(yBox.Text) or teleportDestination.Y
        local z = tonumber(zBox.Text) or teleportDestination.Z
        teleportDestination = Vector3.new(x, y, z)
    end
    xBox.FocusLost:Connect(updateDestination)
    yBox.FocusLost:Connect(updateDestination)
    zBox.FocusLost:Connect(updateDestination)

    -- Eventos dos botões
    teleportBtn.MouseButton1Click:Connect(function()
        updateDestination()
        _G.TeleportPro_TryTeleport(teleportDestination)
    end)
    spawnBtn.MouseButton1Click:Connect(function()
        local spawnPos = getSpawnPosition()
        _G.TeleportPro_TryTeleport(spawnPos)
    end)
    noclipBtn.MouseButton1Click:Connect(function()
        isNoclipActive = not isNoclipActive
        noclipBtn.Text = "Noclip: " .. (isNoclipActive and "LIGADO" or "DESLIGADO") .. " (G)"
        noclipBtn.BackgroundColor3 = isNoclipActive and Color3.fromRGB(100, 210, 100) or Color3.fromRGB(180, 80, 80)
    end)
end

-- Noclip Melhorado (Método mais discreto)
local function toggleNoclip(state)
    if not localPlayer.Character then return end
    
    if state then
        if noclipConnection then noclipConnection:Disconnect() end
        
        -- Método mais seguro: tornar partes não colidíveis
        noclipConnection = RunService.Stepped:Connect(function()
            if localPlayer.Character then
                for _, part in pairs(localPlayer.Character:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
            
            -- Restaurar colisão quando desativado
            if localPlayer.Character then
                for _, part in pairs(localPlayer.Character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = true
                    end
                end
            end
        end
    end
end

-- Teleporte Seguro com Anti-Cheat
local function safeTeleport(destination)
    if isTeleporting or not localPlayer.Character then return end
    isTeleporting = true

    local char = localPlayer.Character
    local root = char:FindFirstChild("HumanoidRootPart")
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    if not root or not humanoid then isTeleporting = false return end

    local prevNoclip = isNoclipActive
    isNoclipActive = true
    toggleNoclip(true)

    -- Pequeno delay aleatório antes do teleporte
    task.wait(math.random(5, 15) / 100)
    
    -- Teleporte direto sem tween (mais discreto)
    root.CFrame = CFrame.new(destination)
    
    -- Pequeno delay após o teleporte
    task.wait(math.random(5, 15) / 100)

    if not prevNoclip then
        isNoclipActive = false
        toggleNoclip(false)
    end

    isTeleporting = false
end

-- Função global para teleporte
function _G.TeleportPro_TryTeleport(dest)
    if isTeleporting then return end
    local target = dest or teleportDestination
    task.spawn(safeTeleport, target)
end

-- Hotkeys
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == teleportKey then
        _G.TeleportPro_TryTeleport(teleportDestination)
    elseif input.KeyCode == noclipKey then
        isNoclipActive = not isNoclipActive
        toggleNoclip(isNoclipActive)
        
        local panel = localPlayer.PlayerGui:FindFirstChild("TeleportPanel")
        if panel then
            local frame = panel:FindFirstChild("Frame")
            if frame then
                local noclipBtn = frame:FindFirstChildWhichIsA("TextButton", true)
                if noclipBtn and noclipBtn.Text:find("Noclip") then
                    noclipBtn.Text = "Noclip: " .. (isNoclipActive and "LIGADO" or "DESLIGADO") .. " (G)"
                    noclipBtn.BackgroundColor3 = isNoclipActive and Color3.fromRGB(100, 210, 100) or Color3.fromRGB(180, 80, 80)
                end
            end
        end
    end
end)

-- Inicialização
task.wait(1) -- Espera o jogador carregar
createTeleportGUI()
StarterGui:SetCore("SendNotification", {
    Title = "Teleport Pro",
    Text = "Script carregado! Use o painel ou F (teleporte) / G (noclip).",
    Duration = 7
})
print("Teleport Pro carregado! Use o painel ou F / G para noclip.")
